---
- name: loop_eensyuu4
  hosts: vyos01
  gather_facts: false


  tasks:
    - name: user
      vyos_command:
        commands: show system login users
      register: result

    - name: before users
      debug:
        var: result.stdout_lines

    - name: add users
      vyos_user:
        name: "{{ item.name }}"
        configured_password: "{{ item.password }}"
        update_password: on_create
        # lines:
          # - "set system login user {{ item.name }} authentication encrypted-password {{ item.password }}"
      loop:
        - name: 'guest1'
          password: 'user2'
        # - name: 'guest2'
        #   password: 'user1'
        # - name: 'guest3' 
        #   password: 'user1'

    - name: after user
      vyos_command:
        commands: show system login users
      register: result

    - name: after users
      debug:
        var: result.stdout_lines
